{% extends "base.html" %}

{% block content %}
<h1>{% block title %}Address Book{% endblock title %}</h1>
<p>Below are all of the people in your address book. Not all of them are users on the site.</p>

<dl>
{% for contact in contacts %}
{% if contact.user.get_profile %}
	<dt id="contact-{{ contact.id }}">
	{# This is a user on the site, so display site user information #}
	{% if contact.user.get_profile.photo %}
		<a href="{{ contact.user.get_profile.get_absolute_url }}" /><img src="{{ MEDIA_URL }}/{{ contact.user.get_profile.photo.thumbnail.url }}" style="border: 0; float: middle;"  /></a>
	{% else %}
		<a href="{{ contact.user.get_profile.get_absolute_url }}" /><img src="{{ MEDIA_URL }}/images/unknown_thumbnail.png" style="border: 0; vertical-align: middle;" /></a>
	{% endif %} 
	<strong><a href="{{ contact.user.get_profile.get_absolute_url }}" />{% firstof contact.user.get_profile.user.get_full_name contact.user.get_profile.user.username %}</a></strong><br />
		{% if request.user in contact.user.get_profile.get_friends_as_users %}{{ contact.user.first_name}} is your contact.{% endif %}
	</dt>
{% else %}
	<dt id="contact-{{ contact.id }}">
		{% if contact.name %}
			<strong class="contact-name">{{ contact.name }}</strong><br /><a class="contact-email" href="mailto:{{ contact.email }}">{{ contact.email }}</a>
		{% else %}
			<strong>&lt;<a class="contact-email" href="mailto:{{ contact.email }}">{{ contact.email }}</a>&gt;</strong>
		{% endif %}
	</dt>
{% endif %}
	<dd>
		{% if contact.user.get_profile.job %}{% if contact.user.get_profile.job.role %}{{ contact.user.get_profile.job.role }} at {% endif %}{{ contact.user.get_profile.job.name }}<br />{% endif %}
		{% if contact.user.get_profile.country %}{{ contact.user.get_profile.country.name }}<br />{% endif %}
		{% if contact.address %}{{ contact.address }}<br />{% endif %}
		{% if contact.phone %}Phone: {{ contact.phone }}<br />{% endif %}
		{% if contact.mobile %}Mobile: {{ contact.mobile }}<br />{% endif %}
		{% if contact.fax %}Fax: {{ contact.fax }}<br />{% endif %}
		{% if contact.website %}Website: <a href="{{ contact.website }}">{{ contact.website }}</a><br />{% endif %}
		{% if not contact.user %}
			<a id="invite-user-{{ contact.id }}" class="invite-user" href="{% url invite_contact contact.id %}">Invite</a>
		{% else %}
			{% if request.user not in contact.user.get_profile.get_friends_as_users %}<a class="invite-friend" href="{% url invite_friend contact.user.username %}">Invite</a>{% endif %}
		{% endif %}
		|
		<a href="{% url edit_contact contact.id %}">Edit Details</a>		
	</dd>
{% endfor %}
</dl>
<form id="invitation-form" method="post" action=""><input type="hidden" name="message" />{% csrf_token %}</form>
<script type="text/javascript">
	$(document).ready(function (){
		$(".invite-user").click(function (e){
			$("invitation_form").empty()
			id = $(this).attr('id').replace('invite-user-','');
			name = $('#contact-'+id+'.contact-name').html();
			email = $('#contact-'+id+'.contact-email').html();
			alert("The name is "+name+" and the email is "+email);
			$confirmbox = $("<div>").addClass('dialog');
			$confirmmsg = $("<div>");
			e.stopPropagation();
			return false;
		});
	});
</script>
{% endblock content %}